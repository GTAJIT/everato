<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Event | Everato Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/public/assets/logo.webp" type="image/webp">
    <style>
        body {
            background: linear-gradient(135deg, #161b22 0%, #23272e 50%, #1f2937 100%);
            min-height: 100vh;
        }

        .admin-card {
            box-shadow: 0 8px 32px 0 rgba(44, 62, 80, 0.37);
            backdrop-filter: blur(8px);
        }

        .input:focus {
            border-color: #06b6d4;
            box-shadow: 0 0 0 2px #06b6d4;
        }
    </style>
</head>

<body class="text-white flex items-center justify-center min-h-screen">
    <main class="admin-card bg-[#161b22]/90 rounded-2xl p-8 w-full max-w-md mx-auto">
        <h2 class="text-2xl font-bold mb-6 text-cyan-400 text-center">Edit Event</h2>
        <form id="editEventForm" class="space-y-4">
            <div>
                <label for="eventName" class="block mb-1 font-semibold text-cyan-300">Event Name</label>
                <input id="eventName" name="eventName" type="text" required
                    class="input w-full px-3 py-2 rounded-lg bg-[#23272e] border border-gray-700 text-white focus:outline-none transition">
            </div>
            <div>
                <label for="eventDate" class="block mb-1 font-semibold text-cyan-300">Date</label>
                <input id="eventDate" name="eventDate" type="date" required
                    class="input w-full px-3 py-2 rounded-lg bg-[#23272e] border border-gray-700 text-white focus:outline-none transition">
            </div>
            <div>
                <label for="eventLocation" class="block mb-1 font-semibold text-cyan-300">Location</label>
                <input id="eventLocation" name="eventLocation" type="text" required
                    class="input w-full px-3 py-2 rounded-lg bg-[#23272e] border border-gray-700 text-white focus:outline-none transition">
            </div>
            <div>
                <label for="eventDesc" class="block mb-1 font-semibold text-cyan-300">Description</label>
                <textarea id="eventDesc" name="eventDesc" rows="3" required
                    class="input w-full px-3 py-2 rounded-lg bg-[#23272e] border border-gray-700 text-white focus:outline-none transition"></textarea>
            </div>
            <button type="submit"
                class="w-full py-2 mt-4 rounded-lg bg-cyan-500 hover:bg-cyan-600 text-white font-bold transition">Save
                Changes</button>
        </form>
        <div id="adminMsg" class="mt-4 text-center text-base"></div>
    </main>
    <script type="module">
        // Get event ID from query string (?id=evt1)
        function getEventId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        async function loadEvents() {
            // Check if we already have events in localStorage
            const cached = localStorage.getItem('everato_events');
            if (cached) {
                return JSON.parse(cached);
            }
            // Otherwise, fetch from static JSON
            try {
                const res = await fetch('/internal/db/temp/events.json');
                if (!res.ok) throw new Error('Fetch failed');
                const events = await res.json();
                localStorage.setItem('everato_events', JSON.stringify(events));
                return events;
            } catch (error) {
                console.error('Error loading events:', error);
                return [];
            }
        }

        function saveEvents(events) {
            localStorage.setItem('everato_events', JSON.stringify(events));
        }

        function fillForm(event) {
            document.getElementById('eventName').value = event.name || '';
            document.getElementById('eventDate').value = event.date || '';
            document.getElementById('eventLocation').value = event.location || '';
            document.getElementById('eventDesc').value = event.description || '';
        }

        async function init() {
            const eventId = getEventId();
            if (!eventId) {
                adminMsg.textContent = "Missing event ID in URL.";
                adminMsg.className = "mt-4 text-center text-red-400";
                document.getElementById('editEventForm').style.display = "none";
                return;
            }

            const events = await loadEvents();
            const event = events.find(e => e.id === eventId);

            if (!event) {
                adminMsg.textContent = "Event not found.";
                adminMsg.className = "mt-4 text-center text-red-400";
                document.getElementById('editEventForm').style.display = "none";
                return;
            }

            fillForm(event);

            document.getElementById('editEventForm').addEventListener('submit', function (e) {
                e.preventDefault();
                event.name = document.getElementById('eventName').value.trim();
                event.date = document.getElementById('eventDate').value;
                event.location = document.getElementById('eventLocation').value.trim();
                event.description = document.getElementById('eventDesc').value.trim();

                saveEvents(events);

                adminMsg.textContent = "Event updated successfully!";
                adminMsg.className = "mt-4 text-center text-green-400";

                setTimeout(() => window.location.href = '/pages/main.html', 1200);
            });
        }

        init();
    </script>

</body>

</html>